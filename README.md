# Chat Friends - ç°ä»£åŒ–å¥½å‹èŠå¤©ç³»ç»Ÿ

> åŸºäº Next.js + Supabase + Socket.IO çš„æç®€é£æ ¼å¥½å‹èŠå¤©åº”ç”¨ï¼Œæ”¯æŒæ³¨å†Œã€ç™»å½•ã€èµ„æ–™å®Œå–„ã€å¥½å‹ç®¡ç†ã€åˆ†ç»„ã€èŠå¤©ï¼ˆæ–‡æœ¬/å›¾ç‰‡/å®æ—¶æ¨é€ï¼‰ã€UIç¾åŒ–ã€é”™è¯¯å¤„ç†ã€äº¤äº’ä½“éªŒä¼˜åŒ–ï¼Œå…¼å®¹æ¡Œé¢ç«¯ä½“éªŒã€‚

---

## âœ¨ ç‰¹æ€§ Features

- **æ³¨å†Œ/ç™»å½•/é‚®ç®±éªŒè¯**ï¼šæ”¯æŒé‚®ç®±æ³¨å†Œã€é‚®ç®±éªŒè¯ã€å¯†ç ç™»å½•ã€‚
- **èµ„æ–™å®Œå–„**ï¼šæ”¯æŒå¤´åƒä¸Šä¼ ã€æ˜µç§°ç¼–è¾‘ã€å¯†ç è®¾ç½®ã€‚
- **å¥½å‹ç®¡ç†**ï¼š
  - æœç´¢é‚®ç®±/æ˜µç§°æ·»åŠ å¥½å‹ï¼Œå¤‡æ³¨ã€åˆ†ç»„ç®¡ç†ã€‚
  - åˆ é™¤å¥½å‹ã€åˆ†ç»„ç­›é€‰ã€åˆ†ç»„ç¼–è¾‘ã€‚
  - ç¦æ­¢æ·»åŠ è‡ªå·±ä¸ºå¥½å‹ï¼Œæ·»åŠ ååŒæ–¹äº’ä¸ºå¥½å‹ã€‚
- **èŠå¤©åŠŸèƒ½**ï¼š
  - æ”¯æŒæ–‡æœ¬ã€å›¾ç‰‡æ¶ˆæ¯ã€‚
  - å®æ—¶æ¶ˆæ¯æ¨é€ï¼Œæœªè¯»æ¶ˆæ¯çº¢ç‚¹æé†’ã€‚
  - èŠå¤©çª—å£è‡ªåŠ¨æ»šåŠ¨ã€æ¶ˆæ¯å·²è¯»å¤„ç†ã€‚
- **UI/äº¤äº’**ï¼š
  - æç®€ç°ä»£é£æ ¼ï¼Œå…¼å®¹Windowsæ¡Œé¢ã€‚
  - ä¾§è¾¹æ åˆ‡æ¢â€œèŠå¤©â€â€œå¥½å‹ç®¡ç†â€â€œæˆ‘çš„èµ„æ–™â€ï¼Œé«˜äº®ä¸çº¢ç‚¹æç¤ºã€‚
  - é€€å‡º/åˆ‡æ¢è´¦å·åŠŸèƒ½ï¼Œæ¨¡æ€å¼¹çª—ç¡®è®¤ã€‚
- **å®‰å…¨æ€§**ï¼šSupabase é‰´æƒã€RLS è¡Œçº§å®‰å…¨ï¼ŒAPIå‚æ•°æ ¡éªŒã€‚
- **AIè¾…åŠ©å¼€å‘**ï¼šæ‰€æœ‰ä¸»è¦æ–‡ä»¶å¤´éƒ¨å‡æœ‰ `// prompt:` æ³¨é‡Šï¼Œä¾¿äºäºŒæ¬¡å¼€å‘ã€‚

---

## ğŸ—‚ï¸ ç›®å½•ç»“æ„

```
chat-friends/
â”œâ”€â”€ src/app/           # Next.js é¡µé¢ä¸APIè·¯ç”±
â”œâ”€â”€ src/lib/           # é€šç”¨åº“ï¼ˆSupabaseã€Socketç­‰ï¼‰
â”œâ”€â”€ src/context/       # Reactå…¨å±€Context
â”œâ”€â”€ supabase/          # Supabaseé…ç½®ä¸SQL
â”œâ”€â”€ public/            # é™æ€èµ„æº
â”œâ”€â”€ package.json       # ä¾èµ–ä¸è„šæœ¬
â””â”€â”€ README.md          # é¡¹ç›®è¯´æ˜
```

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- [Next.js](https://nextjs.org/) 14.x
- [Supabase](https://supabase.com/) (PostgreSQL)
- [Socket.IO](https://socket.io/)
- React 18.x
- TypeScript 5.x

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

1. **å®‰è£…ä¾èµ–**
   ```bash
   npm install
   ```
2. **é…ç½® Supabase**
   - åœ¨ `supabase/` ç›®å½•ä¸‹é…ç½®ä½ çš„ Supabase é¡¹ç›®å‚æ•°ï¼ˆè§ `.env` ç¤ºä¾‹ï¼‰ã€‚
   - ç¡®ä¿æ•°æ®åº“è¡¨ç»“æ„ã€RLSï¼ˆè¡Œçº§å®‰å…¨ï¼‰ã€Storage æƒé™å·²æŒ‰æ–‡æ¡£è®¾ç½®ã€‚
3. **å¯åŠ¨é¡¹ç›®**
   ```bash
   npm run dev
   ```
4. **è®¿é—®**
   - æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:3001`
   - æ³¨å†Œæ–°è´¦å·ï¼ŒæŒ‰æç¤ºå®Œæˆé‚®ç®±éªŒè¯å’Œèµ„æ–™å®Œå–„ã€‚

---

## â˜ï¸ äº‘ç«¯æ•°æ®åº“ä¸é‚®ä»¶ç³»ç»Ÿè¯´æ˜

1. æœ¬é¡¹ç›®ä½¿ç”¨ sysdase çš„çº¿ä¸Š PostgreSQL æ•°æ®åº“ï¼Œæ‰€æœ‰æ•°æ®å‡å­˜å‚¨åœ¨äº‘ç«¯ï¼Œéœ€åœ¨é…ç½®ä¸­å¡«å†™ sysdase æä¾›çš„ keyã€‚
2. é¡¹ç›®é›†æˆäº† sysdase çš„é‚®ä»¶æ”¶å‘ç³»ç»Ÿï¼Œæ‰€æœ‰æ³¨å†Œç”¨æˆ·å¿…é¡»é€šè¿‡çœŸå®é‚®ç®±è¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿è´¦å·å®‰å…¨ã€‚
3. sysdase å¹³å°å·²å°†é‡å®šå‘åœ°å€è®¾ç½®ä¸º `http://localhost:3001`ï¼Œå› æ­¤æœ¬åœ°å¼€å‘å’Œæµ‹è¯•æ—¶è¯·åŠ¡å¿…ä½¿ç”¨ 3001 ç«¯å£è®¿é—®é¡¹ç›®ã€‚

---

## ğŸ“š åŠŸèƒ½å®ç°ä¸åŠ åˆ†é¡¹åˆ†æ

### åŸºç¡€åŠŸèƒ½å®ç°æƒ…å†µ

| åŠŸèƒ½ç‚¹                | å®ç°æƒ…å†µ         | è¯´æ˜/å»ºè®®è¡¥å……                      |
|----------------------|----------------|-----------------------------------|
| å¥½å‹åˆ—è¡¨              | âœ… å·²å®ç°        | `/api/friends`ã€å¥½å‹ç®¡ç†é¡µé¢å·²å…·å¤‡ |
| æœç´¢å¥½å‹              | âœ… å·²å®ç°        | `/api/friends/search`ã€UIå·²å…·å¤‡   |
| æ·»åŠ å¥½å‹              | âœ… å·²å®ç°        | æ”¯æŒå¤‡æ³¨ã€åˆ†ç»„ã€åŒå‘æ·»åŠ            |
| åˆ é™¤å¥½å‹              | âœ… å·²å®ç°        | åŒå‘åˆ é™¤ï¼Œé˜²æ­¢å”¯ä¸€æ€§å†²çª           |
| èŠå¤©å¯¹è¯åˆ—è¡¨          | âœ… å·²å®ç°        | èŠå¤©ä¸»ç•Œé¢å·¦ä¾§ä¸ºä¼šè¯/å¥½å‹åˆ—è¡¨      |
| è·Ÿå¥½å‹èŠå¤©            | âœ… å·²å®ç°        | æ”¯æŒæ–‡æœ¬æ¶ˆæ¯ï¼ŒSocket.IO å®æ—¶æ¨é€   |
| å‘é€å›¾ç‰‡              | âœ… å·²å®ç°        | èŠå¤©çª—å£æ”¯æŒå›¾ç‰‡ä¸Šä¼ ä¸å‘é€         |

### è§„èŒƒä¸å»ºè®®

| è§„èŒƒç‚¹                | å®ç°æƒ…å†µ         | è¯´æ˜/å»ºè®®è¡¥å……                      |
|----------------------|----------------|-----------------------------------|
| AIè¾…åŠ©ç¼–ç +promptæ³¨é‡Š | âœ… å·²å®ç°        | ä¸»è¦æ–‡ä»¶å¤´éƒ¨å‡æœ‰ `// prompt:` æ³¨é‡Š |
| ç›®å½•ç»“æ„æ¸…æ™°          | âœ… å·²å®ç°        | ç»“æ„åˆç†ï¼Œä¾¿äºç»´æŠ¤ä¸æ‰©å±•           |
| RESTful API           | âœ… å·²å®ç°        | API è·¯ç”±å‡ä¸º RESTful é£æ ¼          |
| å‰åç«¯åˆ†ç¦»            | âœ… å·²å®ç°        | APIã€å‰ç«¯ã€Socket.IO åˆ†ç¦»          |
| ä½¿ç”¨Supabase          | âœ… å·²å®ç°        | ä½œä¸ºåç«¯ã€é‰´æƒã€å­˜å‚¨ã€æ•°æ®åº“       |
| æ•°æ®åº“                | âœ… å·²å®ç°        | Supabase é»˜è®¤ PostgreSQL           |
| ä¸€å®šçš„å®‰å…¨æ€§          | âœ… éƒ¨åˆ†å®ç°      | å·²æœ‰é‰´æƒã€RLSï¼Œå»ºè®®è¡¥å……æ›´å¤šå®‰å…¨æªæ–½ |

### åç»­ä¼˜åŒ–

- **æ›´å¤šIMä½“éªŒ**ï¼šå¦‚ç¾¤èŠã€æ¶ˆæ¯æ’¤å›ã€æ‰¹é‡ç®¡ç†ç­‰ã€‚

---

## ğŸ“– è¯¦ç»†æ¥å£æ–‡æ¡£

### æ³¨å†Œ/ç™»å½•

#### POST `/register`
- åŠŸèƒ½ï¼šé‚®ç®±+å¯†ç +æ˜µç§°+å¤´åƒæ³¨å†Œï¼Œæ³¨å†Œåéœ€é‚®ç®±éªŒè¯ã€‚
- è¯·æ±‚å‚æ•°ï¼š
  ```json
  {
    "email": "string",
    "password": "string",
    "nickname": "string",
    "avatar_url": "string (å¯é€‰)"
  }
  ```
- è¿”å›ï¼š
  ```json
  {
    "user": { ... },
    "error": null
  }
  ```

#### POST `/login`
- åŠŸèƒ½ï¼šé‚®ç®±+å¯†ç ç™»å½•ã€‚
- è¯·æ±‚å‚æ•°ï¼š
  ```json
  {
    "email": "string",
    "password": "string"
  }
  ```
- è¿”å›ï¼š
  ```json
  {
    "user": { ... },
    "error": null
  }
  ```

#### POST `/complete-profile`
- åŠŸèƒ½ï¼šé¦–æ¬¡ç™»å½•åå®Œå–„èµ„æ–™ã€‚
- è¯·æ±‚å‚æ•°ï¼š
  ```json
  {
    "nickname": "string",
    "avatar_url": "string (å¯é€‰)"
  }
  ```
- è¿”å›ï¼š
  ```json
  {
    "success": true
  }
  ```

### å¥½å‹ç®¡ç†

#### GET `/api/friends`
- åŠŸèƒ½ï¼šè·å–å½“å‰ç”¨æˆ·çš„å¥½å‹åˆ—è¡¨ã€‚
- Headerï¼š`x-user-id: string`
- è¿”å›ï¼š
  ```json
  {
    "friends": [
      {
        "id": "string",
        "friend_id": "string",
        "remark": "string",
        "group_name": "string",
        "created_at": "string",
        "profiles": {
          "nickname": "string",
          "avatar_url": "string"
        }
      }
    ]
  }
  ```

#### POST `/api/friends`
- åŠŸèƒ½ï¼šæ·»åŠ å¥½å‹ï¼ˆåŒå‘æ’å…¥ï¼Œç¦æ­¢è‡ªåŠ ï¼Œå·²å­˜åœ¨å…ˆåˆ é™¤å†åŠ ï¼‰ã€‚
- Headerï¼š`x-user-id: string`
- è¯·æ±‚å‚æ•°ï¼š
  ```json
  {
    "friend_id": "string",
    "remark": "string (å¯é€‰)",
    "group_name": "string (å¯é€‰)"
  }
  ```
- è¿”å›ï¼š
  ```json
  {
    "success": true
  }
  ```

#### DELETE `/api/friends`
- åŠŸèƒ½ï¼šåˆ é™¤å¥½å‹ï¼ˆåŒå‘åˆ é™¤ï¼‰ã€‚
- Headerï¼š`x-user-id: string`
- è¯·æ±‚å‚æ•°ï¼š
  ```json
  {
    "friend_id": "string"
  }
  ```
- è¿”å›ï¼š
  ```json
  {
    "success": true
  }
  ```

#### PATCH `/api/friends`
- åŠŸèƒ½ï¼šå¤‡æ³¨/åˆ†ç»„ç¼–è¾‘ã€‚
- Headerï¼š`x-user-id: string`
- è¯·æ±‚å‚æ•°ï¼š
  ```json
  {
    "friend_id": "string",
    "remark": "string (å¯é€‰)",
    "group_name": "string (å¯é€‰)"
  }
  ```
- è¿”å›ï¼š
  ```json
  {
    "success": true
  }
  ```

#### GET `/api/friends/search`
- åŠŸèƒ½ï¼šé€šè¿‡é‚®ç®±æˆ–æ˜µç§°æ¨¡ç³Šæœç´¢ç”¨æˆ·ã€‚
- Headerï¼š`x-user-id: string`
- æŸ¥è¯¢å‚æ•°ï¼š`q=å…³é”®è¯`
- è¿”å›ï¼š
  ```json
  {
    "users": [
      {
        "id": "string",
        "nickname": "string",
        "avatar_url": "string",
        "email": "string"
      }
    ]
  }
  ```

#### GET `/api/friends/groups`
- åŠŸèƒ½ï¼šè·å–æ‰€æœ‰åˆ†ç»„ã€‚
- Headerï¼š`x-user-id: string`
- è¿”å›ï¼š
  ```json
  {
    "groups": ["åˆ†ç»„1", "åˆ†ç»„2", ...]
  }
  ```

### èŠå¤©ç›¸å…³

#### GET `/api/messages`
- åŠŸèƒ½ï¼šè·å–ä¸æŸå¥½å‹çš„å†å²æ¶ˆæ¯ã€‚
- Headerï¼š`x-user-id: string`
- æŸ¥è¯¢å‚æ•°ï¼š`friend_id=string`
- è¿”å›ï¼š
  ```json
  {
    "messages": [
      {
        "id": "string",
        "sender_id": "string",
        "receiver_id": "string",
        "content": "string",
        "image_url": "string (å¯é€‰)",
        "created_at": "string",
        "is_read": true
      }
    ]
  }
  ```

#### POST `/api/messages`
- åŠŸèƒ½ï¼šå‘é€æ¶ˆæ¯ï¼ˆæ–‡æœ¬/å›¾ç‰‡ï¼‰ã€‚
- Headerï¼š`x-user-id: string`
- è¯·æ±‚å‚æ•°ï¼š
  ```json
  {
    "friend_id": "string",
    "content": "string (å¯é€‰)",
    "image_url": "string (å¯é€‰)"
  }
  ```
- è¿”å›ï¼š
  ```json
  {
    "success": true
  }
  ```

#### GET `/api/messages/unread-count`
- åŠŸèƒ½ï¼šè·å–æ‰€æœ‰æœªè¯»æ¶ˆæ¯æ€»æ•°åŠæ¯ä¸ªå¥½å‹çš„æœªè¯»æ•°ã€‚
- Headerï¼š`x-user-id: string`
- è¿”å›ï¼š
  ```json
  {
    "total": 3,
    "perFriend": {
      "friend_id1": 2,
      "friend_id2": 1
    }
  }
  ```

#### POST `/api/messages/mark-read`
- åŠŸèƒ½ï¼šå°†ä¸æŸå¥½å‹çš„æ¶ˆæ¯æ ‡è®°ä¸ºå·²è¯»ã€‚
- Headerï¼š`x-user-id: string`
- è¯·æ±‚å‚æ•°ï¼š
  ```json
  {
    "friend_id": "string"
  }
  ```
- è¿”å›ï¼š
  ```json
  {
    "success": true
  }
  ```

---

## â“ å¸¸è§é—®é¢˜ FAQ

1. **æ·»åŠ /åˆ é™¤å¥½å‹ååˆ—è¡¨æœªåˆ·æ–°ï¼Ÿ**
   - å·²å®ç°æ·»åŠ /åˆ é™¤åè‡ªåŠ¨åˆ·æ–°å¥½å‹åˆ—è¡¨ï¼Œè‹¥é‡åˆ°é—®é¢˜è¯·åˆ·æ–°é¡µé¢æˆ–æ£€æŸ¥ç½‘ç»œã€‚
2. **åˆ é™¤å¥½å‹åæ— æ³•é‡æ–°æ·»åŠ ï¼Ÿ**
   - å·²ä¿®å¤ä¸ºåŒå‘åˆ é™¤+æ·»åŠ å‰å…ˆåˆ é™¤ï¼Œå½»åº•é¿å…å”¯ä¸€æ€§å†²çªã€‚
3. **å¤šçª—å£å¤šè´¦å·ç™»å½•å†²çªï¼Ÿï¼ˆæ–¹ä¾¿æµ‹è¯•ï¼‰**
   - å·²ç§»é™¤ localStorage ä¾èµ–ï¼Œå®Œå…¨ä¾èµ– Supabase sessionï¼Œæ¯ä¸ªçª—å£äº’ä¸å½±å“ã€‚
4. **é‚®ç®±éªŒè¯é“¾æ¥æ‰“ä¸å¼€ï¼Ÿ**
   - é‚®ç®±å®¢æˆ·ç«¯å¯èƒ½ç”¨ iframe sandbox æ‰“å¼€ï¼Œå»ºè®®å¤åˆ¶é“¾æ¥åˆ°æµè§ˆå™¨æ–°æ ‡ç­¾é¡µè®¿é—®ã€‚
5. **æœªæ¥å¯ä¼˜åŒ–æ–¹å‘**
   - æ”¯æŒç¾¤èŠã€æ¶ˆæ¯æ’¤å›ã€è¡¨æƒ…åŒ…ã€æ¶ˆæ¯æ¼«æ¸¸ã€‚
   - æ›´ä¸°å¯Œçš„èµ„æ–™é¡µã€å¥½å‹å¤‡æ³¨/åˆ†ç»„æ‰¹é‡ç®¡ç†ã€‚
   - æ›´ç»†è‡´çš„é”™è¯¯æç¤ºä¸æ“ä½œå¼•å¯¼ã€‚


## ğŸ“„ è®¸å¯è¯ License

MIT License Â© 2024 Xurufen & Chat Friends Contributors 